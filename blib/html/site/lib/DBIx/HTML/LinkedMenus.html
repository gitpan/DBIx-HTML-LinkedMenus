<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>C&lt;DBIx::HTML::LinkedMenus&gt; - Convert db data to 2 linked HTML popup menus.</title>
<link rev="made" href="mailto:" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">Synopsis</a></li>
	<li><a href="#description">Description</a></li>
	<li><a href="#distributions">Distributions</a></li>
	<li><a href="#usage">Usage</a></li>
	<li><a href="#options">Options</a></li>
	<li><a href="#methods">Methods</a></li>
	<li><a href="#sample_code">Sample Code</a></li>
	<li><a href="#see_also">See Also</a></li>
	<li><a href="#author">Author</a></li>
	<li><a href="#copyright">Copyright</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p><code>DBIx::HTML::LinkedMenus</code> - Convert db data to 2 linked HTML popup menus.</p>
<p>
</p>
<hr />
<h1><a name="synopsis">Synopsis</a></h1>
<pre>
        use DBIx::HTML::LinkedMenus;</pre>
<pre>
        my($linker) = DBIx::HTML::LinkedMenus -&gt; new
        (
                dbh        =&gt; $dbh,
                base_sql   =&gt; 'select campus_id, campus_name, campus_id ' .
                                                'from campus order by campus_name',
                linked_sql =&gt; 'select unit_id, unit_code from unit where ' .
                                                'unit_campus_id = ? order by unit_code',
        );</pre>
<pre>
        # Print as part of a form:</pre>
<pre>
        print $q -&gt; start_form...
        print $linker -&gt; javascript_for_db();
        print $linker -&gt; html_for_base_menu();
        print $linker -&gt; html_for_linked_menu();
        print $linker -&gt; javascript_for_init_menu();</pre>
<pre>
        # Alternately, print as part of a page:</pre>
<pre>
        my(@on_load) = $linker -&gt; javascript_for_on_load();</pre>
<pre>
        print $q -&gt; start_html({title =&gt; 'Linked Menus', @on_load}),
        print $q -&gt; start_form...
        print $linker -&gt; javascript_for_db();
        print $linker -&gt; html_for_base_menu();
        print $linker -&gt; html_for_linked_menu();</pre>
<p>
</p>
<hr />
<h1><a name="description">Description</a></h1>
<p>This module takes a db handle and 2 SQL statements, and builds an internal hash.</p>
<p>Details of the SQL are explained below.</p>
<p>Then you ask for that hash in the form of both JavaScript and HTML.</p>
<p>The JavaScript is in 2 parts:</p>
<dl>
<dt><strong><a name="item_the_data_and_some_general_functions">The data and some general functions</a></strong><br />
</dt>
<dt><strong><a name="item_a_function_call_to_initialize_the_linked%2dmenu_sy">A function call to initialize the linked-menu system</a></strong><br />
</dt>
<dd>
This initialization code can be output after the other components of the
form, or it can be output as the form's onLoad event handler.
</dd>
<dd>
<p>Either way, it must be called.</p>
</dd>
<p></p></dl>
<p>The HTML is also in 2 parts:</p>
<dl>
<dt><strong><a name="item_the_html_for_the_base_menu">The HTML for the base menu</a></strong><br />
</dt>
<dd>
As the user of the form changes her selection on the base menu,
the available items on the linked menu change in lockstep.
</dd>
<dd>
<p>The selections on the base menu are determined by the base_sql parameter.</p>
</dd>
<p></p>
<dt><strong><a name="item_the_html_for_the_linked_menu">The HTML for the linked menu</a></strong><br />
</dt>
<dd>
The selections on the linked menu, for each base menu selection, are determined
by the linked_sql parameter.
</dd>
<p></p></dl>
<p>These are available separately so you can place them anywhere on your form.</p>
<p>After a call to new, you can call the 'size' method if you need to check how
many rows were returned by the base SQL you used.</p>
<p>Neither the module CGI.pm, nor any of that kidney, are used by this module.
We simply output pure HTML.</p>
<p>However, for simplicity, this document pretends you are using CGI.pm rather
than an alternative. The sentences would become too convoluted otherwise.</p>
<p>
</p>
<hr />
<h1><a name="distributions">Distributions</a></h1>
<p>This module is available both as a Unix-style distro (*.tgz) and an
ActiveState-style distro (*.ppd). The latter is shipped in a *.zip file.</p>
<p>See <a href="http://savage.net.au/Perl-modules/html/installing-a-module.html">http://savage.net.au/Perl-modules/html/installing-a-module.html</a> for
help on unpacking and installing each type of distro.</p>
<p>
</p>
<hr />
<h1><a name="usage">Usage</a></h1>
<p>You create an object of the class by calling the constructor, 'new'.</p>
<p>Now call four (4) methods to get the HTML and the JavaScript.</p>
<p>Lastly, display the HTML and JavaScript as part of a form.</p>
<p>
</p>
<hr />
<h1><a name="options">Options</a></h1>
<p>Here, in alphabetical order, are the options accepted by the constructor,
together with their default values.</p>
<dl>
<dt><strong><a name="item_base_menu_name_%3d%3e_%27dbix_base_menu%27">base_menu_name =&gt; 'dbix_base_menu'</a></strong><br />
</dt>
<dd>
This option is not mandatory, since it has a default value.
</dd>
<dd>
<p>The value of this parameter is what you would pass into a CGI object when you
call its <code>param()</code> method to retrieve the user's selection on the base menu.</p>
</dd>
<dd>
<p>But don't call CGI's param(). Call our <a href="#item_get"><code>get()</code></a> method, and it will return
the base and linked menu selections from the internal hash holding the data.</p>
</dd>
<p></p>
<dt><strong><a name="item_base_sql_%3d%3e_%27%27">base_sql =&gt; ''</a></strong><br />
</dt>
<dd>
This option is mandatory.
</dd>
<dd>
<p>This is the SQL used to select items for the base menu.</p>
</dd>
<dd>
<p>The SQL must select three (3) columns, in this order:</p>
</dd>
<dl>
<dt><strong><a name="item_first_column">First column</a></strong><br />
</dt>
<dd>
The first column will be used as the value returned by a CGI object, for example,
when you call its param(&lt;base_menu_name&gt;) method.
</dd>
<p></p>
<dt><strong><a name="item_second_column">Second column</a></strong><br />
</dt>
<dd>
The second column will be used as the visible selection offered to the user on the
base menu.
</dd>
<p></p>
<dt><strong><a name="item_third_column">Third column</a></strong><br />
</dt>
<dd>
The third column will be used as the value plugged into the linked_sql in place
of the ? to select a set of items for the linked menu which will correspond to the base
menu item.
</dd>
<p></p></dl>
<p>Of course, the first 2 columns selected could be the same:</p>
<pre>
        base_sql =&gt; 'select campus_name, campus_name, campus_id ' .
                                'from campus order by campus_name'</pre>
<p>But normally you would do this:</p>
<pre>
        base_sql =&gt; 'select campus_id, campus_name, campus_id from ' .
                                'campus order by campus_name'</pre>
<p>Again: This means that the second column is used to construct visible menu items, and
when an item is selected by the user, the first column is what is returned to your
CGI script, and the third column is used to select items for the linked menu.</p>
<dt><strong><a name="item_dbh_%3d%3e_%27%27">dbh =&gt; ''</a></strong><br />
</dt>
<dd>
Pass in an open database handle.
</dd>
<dd>
<p>This option is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_form_name_%3d%3e_%27dbix_form%27">form_name =&gt; 'dbix_form'</a></strong><br />
</dt>
<dd>
This option is not mandatory, since it has a default value.
</dd>
<dd>
<p>The value of this parameter becomes the name for the form used in the
JavaScript, and must be the name used by you in your call to CGI's <code>start_form()</code>
or <code>start_multipart_form()</code> method.</p>
</dd>
<p></p>
<dt><strong><a name="item_linked_menu_name_%3d%3e_%27dbix_linked_menu%27">linked_menu_name =&gt; 'dbix_linked_menu'</a></strong><br />
</dt>
<dd>
This option is not mandatory, since it has a default value.
</dd>
<dd>
<p>The value of this parameter is what you would pass into a CGI object when you
call its <code>param()</code> method to retrieve the user's selection on the linked menu.</p>
</dd>
<dd>
<p>But don't call CGI's param(). Call our <a href="#item_get"><code>get()</code></a> method, and it will return
the base and linked menu selections from the internal hash holding the data.</p>
</dd>
<p></p>
<dt><strong><a name="item_linked_sql_%3d%3e_%27%27">linked_sql =&gt; ''</a></strong><br />
</dt>
<dd>
This option is mandatory.
</dd>
<dd>
<p>This is the SQL used to select items for the linked menu for each
selection of the base menu.</p>
</dd>
<dd>
<p>The SQL must select two (2) columns, in this order:</p>
</dd>
<dl>
<dt><strong>First column</strong><br />
</dt>
<dd>
The first column will be used as the value returned by a CGI object, for example,
when you call its param(&lt;linked_menu_name&gt;) method.
</dd>
<p></p>
<dt><strong>Second column</strong><br />
</dt>
<dd>
The second column will be used as the visible selection offered to the user on the
linked menu.
</dd>
<p></p></dl>
<p>Of course, the first 2 columns selected could be the same:</p>
<pre>
        linked_sql =&gt; 'select unit_code, unit_code from unit where ' .
                                'unit_campus_id = ? order by unit_code',</pre>
<p>But normally you would do this:</p>
<pre>
        linked_sql =&gt; 'select unit_id, unit_code from unit where ' .
                                'unit_campus_id = ? order by unit_code',</pre>
<p>Again: This means that the second column is used to construct visible menu items, and
when an item is selected by the user, the first column is what is returned to your
CGI script.</p>
<p>Now, notice the where clause. Each value of column three (3) returned by the base_sql
is used to select a set of items for the linked menu. The ? in the linked_sql's where
clause is where the value from the third column of the base_sql is plugged into the
linked_sql.</p>
<p>If a particular value of the base_sql's column three (3) does not return any items for
the linked menu, then that basic item does not appear on the base menu.</p>
</dl>
<p>
</p>
<hr />
<h1><a name="methods">Methods</a></h1>
<dl>
<dt><strong><a name="item_get">get($base_id, $link_id)</a></strong><br />
</dt>
<dd>
Returns the 2 visible menu items, (base, linked), corresponding to the 2 menu
selections.
</dd>
<dd>
<p>Returns () if either $base_id or $link_id is not a key into the internal hash
holding the data.</p>
</dd>
<dd>
<p>You would normally do something like this:</p>
</dd>
<dd>
<pre>
        my($base_id) = $q -&gt; param('dbix_base_menu')   || '';
        my($link_id) = $q -&gt; param('dbix_linked_menu') || '';
        my($linker)  = ...
        my(@value)   = $linker -&gt; get($base_id, $link_id);</pre>
</dd>
<p></p>
<dt><strong><a name="item_html_for_base_menu"><code>html_for_base_menu()</code></a></strong><br />
</dt>
<dd>
Returns the HTML for a popup menu named after the base_menu_name parameter.
</dd>
<dd>
<p>Output it somewhere suitable on your page.</p>
</dd>
<dd>
<p>Calling this method and outputting the HTML is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_html_for_linked_menu"><code>html_for_linked_menu()</code></a></strong><br />
</dt>
<dd>
Returns the HTML for a popup menu named after the linked_menu_name parameter.
</dd>
<dd>
<p>Output it somewhere suitable on your page.</p>
</dd>
<dd>
<p>Calling this method and outputting the HTML is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_javascript_for_db"><code>javascript_for_db()</code></a></strong><br />
</dt>
<dd>
Returns JavaScript, including the &lt;script&gt;...&lt;/script&gt; tags, which holds your data in a
JavaScript db, and includes some JavaScript functions.
</dd>
<dd>
<p>Output it somewhere suitable on your page.</p>
</dd>
<dd>
<p>Calling this method and outputting the JavaScript is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_javascript_for_init_menu"><code>javascript_for_init_menu()</code></a></strong><br />
</dt>
<dd>
Returns JavaScript, including the &lt;script&gt;...&lt;/script&gt; tags, which holds the function call
to a function which initializes the linked-menu system. The function itself is included in
the code returned by javascript_for_db().
</dd>
<dd>
<p>Output it somewhere on your page after you have output the 2 pieces of HTML and after
you have output the string returned from javascript_for_db().</p>
</dd>
<dd>
<p>Calling this method is optional. If you do not call it, then calling the method
<a href="#item_javascript_for_on_load"><code>javascript_for_on_load()</code></a> is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_javascript_for_on_load"><code>javascript_for_on_load()</code></a></strong><br />
</dt>
<dd>
Returns a string to be used as a &lt;body&gt; tag's onLoad event handler. It calls the
function which initializes the linked-menu system. The function itself is included in
the code returned by javascript_for_db().
</dd>
<dd>
<p>Output it as part of the &lt;body&gt; tag. See examples/test-linked-menus.cgi for an
example.</p>
</dd>
<dd>
<p>Calling this method is optional. If you do not call it, then calling the method
<a href="#item_javascript_for_init_menu"><code>javascript_for_init_menu()</code></a> is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_new"><code>new(%arg)</code></a></strong><br />
</dt>
<dd>
The constructor.
</dd>
<dd>
<p>See the previous section for details of the parameters.</p>
</dd>
<p></p>
<dt><strong><a name="item_size"><code>size()</code></a></strong><br />
</dt>
<dd>
Returns the number of rows returned by your base SQL.
</dd>
<dd>
<p>It will tell you whether or not your base menu is empty.</p>
</dd>
<p></p></dl>
<p>
</p>
<hr />
<h1><a name="sample_code">Sample Code</a></h1>
<p>See examples/test-linked-menus.cgi for a complete program.</p>
<p>You will need to run examples/bootstrap-menus.pl to load the 'test'
database, 'campus' and 'unit' tables, with sample data.</p>
<p>You'll have to patch these 2 programs vis-a-vis the db vendor, username
and password.</p>
<p>The sample data in bootstrap-menus.pl is simple, but is used by several
modules, so don't be too keen on changing it :-).</p>
<p>
</p>
<hr />
<h1><a name="see_also">See Also</a></h1>
<pre>
        CGI::Explorer
        DBIx::HTML::ClientDB
        DBIx::HTML::PopupRadio</pre>
<p>The latter 2 modules will be released after the current one.</p>
<p>
</p>
<hr />
<h1><a name="author">Author</a></h1>
<p><code>DBIx::HTML::LinkedMenus</code> was written by Ron Savage <em>&lt;<a href="mailto:ron@savage.net.au">ron@savage.net.au</a>&gt;</em> in 2002.</p>
<p>Home page: <a href="http://savage.net.au/index.html">http://savage.net.au/index.html</a></p>
<p>
</p>
<hr />
<h1><a name="copyright">Copyright</a></h1>
<p>Austrlian copyright (c) 2002, Ron Savage. All rights reserved.</p>
<pre>
        All Programs of mine are 'OSI Certified Open Source Software';
        you can redistribute them and/or modify them under the terms of
        The Artistic License, a copy of which is available at:
        <a href="http://www.opensource.org/licenses/index.html">http://www.opensource.org/licenses/index.html</a></pre>

</body>

</html>
